pipeline {
    agent any

    environment {
        dockerImage = 'ghfranjabour/lab1_big_data_infrastructure:latest'
        containerName = 'lab1_c'
    }

    stages {
        stage('Pull Docker Image') {
            steps {
                script {
                    println("${pwd()}")
                    bat "docker pull ${dockerImage}"
                }
            }
        }

        stage('Launch Docker Container') {
            steps {
                script {
                    // Launch the Docker container
                    bat "docker run -d -it --name ${containerName} ${dockerImage}"
                }
            }
        }

        stage('Install requirements') {
            steps {
                script {
                    // Launch the Docker container
                    bat "docker exec ${containerName} python -m pip install -r requirements.txt"
                }
            }
        }
        stage('Run Test Script') {
            steps {
                script {
                    // Execute the Python test script inside the container
                    bat "docker exec ${containerName} python -m unittest src/test_unit/test_process_data.py"
                    bat "docker exec ${containerName} python -m unittest src/test_unit/test_classifier.py"
                }
            }
        }
    }
}